var assert = require('assert');

var specs = require('./index');

var engine = specs.engine();

engine.directive('test', function (model, compile, analyse) {
  return function (x) { return x == 'test'; };
});

[
  [ 'number', 42, [ 42 ], [ 0, 24 ] ],
  [ 'string', 'foo', [ 'foo' ], [ null, 'bar' ] ],
  [ 'boolean', true, [ true ], [ null, false ] ],
  [ 'null', null, [ null ], [ 42, 'foo' ] ],
  [ '~', /foo+bar/, [ 'foobar', 'foooooooobar' ], [ 'fobar', null, 42, true ] ],
  [ '[scalar]', [ true, 42, 'foo', null ], [ true, 42, 'foo', null ], [ false, 24, 'bar' ] ],
  [ '{∅}', {}, [ {}, { a: 1 } ], [ ] ],
  [ '{…}', { foo: 42 }, [ { foo: 42 }, { foo: 42, bar: 24 } ], [ {}, { bar: 24 } ] ],
  [ '[{},42]', [ { foo: 42 }, 42 ], [ { foo: 42 }, 42 ], [ {}, { bar: 24 }, 24 ] ],
  [ '{$}', { $test: true }, [ 'test' ], [ true, 42, 'foo', {}, null ] ]
].forEach(function (suite) {
  console.log(suite[0]);
  var spec = engine.compile(suite[1]);
  suite[2].forEach(function (x) { assert(spec(x)); });
  suite[3].forEach(function (x) { assert(!spec(x)); });
});

